<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AutoPitch — Success</title>
  <style> body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;padding:24px;background:#0b1020;color:#e8ecf5} .card{max-width:720px;margin:0 auto;background:#11162a;border:1px solid #1e2742;border-radius:14px;padding:18px} .row{display:flex;gap:10px;align-items:center;justify-content:space-between} .btn{padding:10px 14px;border-radius:10px;border:1px solid #1e2742;background:#0f173a;color:#e8ecf5;font-weight:600;cursor:pointer} .btn.primary{background:#6d7cff;border-color:#6d7cff;color:#fff} .muted{color:#a3acc0;font-size:14px} </style>
</head>
<body>
  <div class="card">
    <h2>✅ You’re all set!</h2>
    <p class="muted">Thanks for subscribing. This device is now being upgraded…</p>
    <div class="row">
      <button id="btn-app" class="btn">Back to app</button>
      <button id="btn-manage" class="btn primary">Manage billing</button>
    </div>
  </div>
  <script>
    (async function(){
      const params = new URLSearchParams(location.search);
      const sessionId = params.get('session_id');
      const appBase = location.origin;
      document.getElementById('btn-app').onclick = () => location.href = appBase + '/';
      document.getElementById('btn-manage').onclick = async () => {
        const r = await fetch('/portal', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(sessionId ? { sessionId } : {}) });
        const j = await r.json(); if (j.url) location.href = j.url; else alert('Could not open billing portal');
      };
      if (sessionId) { try { await fetch('/claim', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ sessionId }) }); } catch {} }
    })();
  </script>
</body>
</html>